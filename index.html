<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ù…Ø¯Ø±Ø¨ Ø§Ù„ØªØ¬ÙˆÙŠØ¯ - Ø±ÙˆØ§ÙŠØ© ÙˆØ±Ø´ Ø¹Ù† Ù†Ø§ÙØ¹</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/browser-id3-writer@4.4.0/dist/browser-id3-writer.min.js"></script>
  
  <!-- KFGQPC Warsh Font from King Fahd Complex -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/thetruetruth/quran-data-kfgqpc@main/css/kfgqpc.font.css" />
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap');
    
    /* Warsh-specific font stack */
    .font-warsh { 
      font-family: "warsh10", "KFGQPC Uthmanic Script Warsh", "Amiri", "Noto Naskh Arabic", serif;
    }
    .font-arabic { 
      font-family: "Amiri", "Noto Naskh Arabic", serif; 
    }
    
    /* Mobile-friendly touch targets */
    @media (max-width: 768px) {
      button, select, input { min-height: 48px; }
    }
    
    html { scroll-behavior: smooth; }
    .overflow-y-auto { -webkit-overflow-scrolling: touch; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Warsh color scheme - earthy North African palette */
    :root {
      --warsh-primary: #1e3a5f;
      --warsh-secondary: #c9a227;
      --warsh-accent: #8b4513;
      --warsh-light: #f5e6d3;
    }
    
    /* Tajweed rule colors - Warsh specific */
    .tajweed-naql { color: #0891b2; font-weight: bold; } /* Cyan */
    .tajweed-taqlil { color: #ea580c; font-weight: bold; } /* Orange */
    .tajweed-tashil { color: #9333ea; font-weight: bold; } /* Purple */
    .tajweed-ibdal { color: #ec4899; font-weight: bold; } /* Pink */
    .tajweed-tarqiq-ra { color: #0ea5e9; font-weight: bold; } /* Sky blue */
    .tajweed-madd-badal { color: #dc2626; font-weight: bold; } /* Red */
    .tajweed-madd-6 { color: #991b1b; font-weight: bold; } /* Dark red */
    .tajweed-ghunnah { color: #16a34a; font-weight: bold; } /* Green */
    .tajweed-qalqalah { color: #2563eb; font-weight: bold; } /* Blue */
    .tajweed-tafkheem { color: #1d4ed8; font-weight: bold; } /* Dark blue */
    .tajweed-silent { color: #64748b; font-weight: bold; } /* Gray */
    
    /* Safe area for mobile */
    .safe-area-inset {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-amber-100 via-orange-50 to-yellow-100">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useRef, useEffect, useCallback } = React;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // WARSH TAJWEED COLOR SYSTEM
    // Based on Maghrebi/North African Mushaf traditions
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const WARSH_COLORS = {
      // Warsh-specific rules
      NAQL:       '#0891b2',  // Ù†Ù‚Ù„ - Cyan (vowel transfer)
      TAQLIL:     '#ea580c',  // ØªÙ‚Ù„ÙŠÙ„ - Orange (alif toward ya)
      TASHIL:     '#9333ea',  // ØªØ³Ù‡ÙŠÙ„ - Purple (hamza softening)
      IBDAL:      '#ec4899',  // Ø¥Ø¨Ø¯Ø§Ù„ - Pink (hamza replacement)
      TARQIQ_RA:  '#0ea5e9',  // ØªØ±Ù‚ÙŠÙ‚ Ø§Ù„Ø±Ø§Ø¡ - Sky blue (light ra)
      
      // Madd rules (Warsh extends more)
      MADD_BADAL: '#dc2626',  // Ù…Ø¯ Ø§Ù„Ø¨Ø¯Ù„ - Red (2/4/6 in Warsh)
      MADD_6:     '#991b1b',  // Ù…Ø¯ Ù„Ø§Ø²Ù…/Ù…ØªØµÙ„/Ù…Ù†ÙØµÙ„ - Dark red (6 counts)
      MADD_TABII: '#b91c1c',  // Ù…Ø¯ Ø·Ø¨ÙŠØ¹ÙŠ - Medium red (2 counts)
      
      // Shared rules
      GHUNNAH:    '#16a34a',  // ØºÙ†Ø© - Green
      QALQALAH:   '#2563eb',  // Ù‚Ù„Ù‚Ù„Ø© - Blue
      TAFKHEEM:   '#1d4ed8',  // ØªÙØ®ÙŠÙ… - Dark blue
      SILENT:     '#64748b',  // ØµØ§Ù…Øª - Gray
    };

    const WARSH_TAJWEED_RULES = {
      naql: {
        color: WARSH_COLORS.NAQL,
        name: 'Naql',
        arabic: 'Ù†Ù‚Ù„',
        description: 'Ù†Ù‚Ù„ Ø­Ø±ÙƒØ© Ø§Ù„Ù‡Ù…Ø²Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø§ÙƒÙ† Ù‚Ø¨Ù„Ù‡Ø§',
        howTo: 'Ø§Ù„Ø­Ø±ÙƒØ© ØªÙ†ØªÙ‚Ù„ Ù…Ù† Ø§Ù„Ù‡Ù…Ø²Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø³Ø§ÙƒÙ† Ù‚Ø¨Ù„Ù‡Ø§ ÙˆØªØ³Ù‚Ø· Ø§Ù„Ù‡Ù…Ø²Ø©',
        example: 'Ù…ÙÙ†Ù Ø§Ø³ØªÙØºÙ†Ù‰ â† Ù…ÙÙ†Ù Ø³ØªÙØºÙ†Ù‰'
      },
      taqlil: {
        color: WARSH_COLORS.TAQLIL,
        name: 'Taqlil',
        arabic: 'ØªÙ‚Ù„ÙŠÙ„',
        description: 'Ø¥Ù…Ø§Ù„Ø© Ø§Ù„Ø£Ù„Ù Ù†Ø­Ùˆ Ø§Ù„ÙŠØ§Ø¡',
        howTo: 'ØªÙÙ‚Ø±Ø£ Ø§Ù„Ø£Ù„Ù Ø¨ÙŠÙ† Ø§Ù„Ø£Ù„Ù ÙˆØ§Ù„ÙŠØ§Ø¡ (ØµÙˆØª Ø¨ÙŠÙ† Ø§Ù„ÙØªØ­Ø© ÙˆØ§Ù„ÙƒØ³Ø±Ø©)',
        example: 'Ø§Ù„ÙƒØ§ÙÙØ±ÙŠÙ†ØŒ Ù…ÙˆØ³Ù‰ØŒ Ø¹ÙŠØ³Ù‰'
      },
      tashil: {
        color: WARSH_COLORS.TASHIL,
        name: 'Tashil',
        arabic: 'ØªØ³Ù‡ÙŠÙ„',
        description: 'ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ù‡Ù…Ø²Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¡ Ù‡Ù…Ø²ØªÙŠÙ†',
        howTo: 'ØªÙÙ†Ø·Ù‚ Ø§Ù„Ù‡Ù…Ø²Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø¨ØµÙˆØª Ø¨ÙŠÙ† Ø§Ù„Ù‡Ù…Ø²Ø© ÙˆØ§Ù„Ø£Ù„Ù',
        example: 'Ø£ÙØ£ÙÙ†Ø°Ø±ØªÙ‡Ù… â† Ø£ÙØ§ÙÙ†Ø°Ø±ØªÙ‡Ù…'
      },
      ibdal: {
        color: WARSH_COLORS.IBDAL,
        name: 'Ibdal',
        arabic: 'Ø¥Ø¨Ø¯Ø§Ù„',
        description: 'Ø¥Ø¨Ø¯Ø§Ù„ Ø§Ù„Ù‡Ù…Ø²Ø© Ø§Ù„Ø³Ø§ÙƒÙ†Ø© Ø­Ø±Ù Ù…Ø¯',
        howTo: 'ØªÙØ¨Ø¯Ù„ Ø§Ù„Ù‡Ù…Ø²Ø© Ø§Ù„Ø³Ø§ÙƒÙ†Ø© Ø¨Ø­Ø±Ù Ù…Ø¯ Ù…Ù† Ø¬Ù†Ø³ Ø­Ø±ÙƒØ© Ù…Ø§ Ù‚Ø¨Ù„Ù‡Ø§',
        example: 'ÙŠÙØ¤Ù…Ù†ÙˆÙ† â† ÙŠÙÙˆÙ…Ù†ÙˆÙ†'
      },
      tarqiq_ra: {
        color: WARSH_COLORS.TARQIQ_RA,
        name: 'Tarqiq Ra',
        arabic: 'ØªØ±Ù‚ÙŠÙ‚ Ø§Ù„Ø±Ø§Ø¡',
        description: 'ØªØ±Ù‚ÙŠÙ‚ Ø§Ù„Ø±Ø§Ø¡ Ø­ØªÙ‰ Ù…Ø¹ Ø§Ù„ÙØªØ­ Ø£Ùˆ Ø§Ù„Ø¶Ù… Ø¥Ø°Ø§ Ø³Ø¨Ù‚Ù‡Ø§ ÙƒØ³Ø±',
        howTo: 'ØªÙØ±Ù‚Ù‚ Ø§Ù„Ø±Ø§Ø¡ (ØªÙÙ†Ø·Ù‚ Ø®ÙÙŠÙØ©) Ø¥Ø°Ø§ Ø³Ø¨Ù‚Ù‡Ø§ Ø­Ø±Ù Ù…ÙƒØ³ÙˆØ±',
        example: 'ÙÙØ±Ø¹ÙÙˆÙ†ØŒ Ø§Ù„Ø°ÙÙ‘ÙƒØ±Ù'
      },
      madd_badal: {
        color: WARSH_COLORS.MADD_BADAL,
        name: 'Madd Badal',
        arabic: 'Ù…Ø¯ Ø§Ù„Ø¨Ø¯Ù„',
        counts: '2/4/6',
        description: 'Ù…Ø¯ Ø§Ù„Ø¨Ø¯Ù„ - Ø­Ø±ÙƒØªØ§Ù† Ø£Ùˆ 4 Ø£Ùˆ 6 Ø¹Ù†Ø¯ ÙˆØ±Ø´',
        howTo: 'ÙŠØ¬ÙˆØ² Ø§Ù„Ù…Ø¯ Ø¨Ù€ 2 Ø£Ùˆ 4 Ø£Ùˆ 6 Ø­Ø±ÙƒØ§Øª (Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø¬Ø§Ø¦Ø²Ø©)'
      },
      madd_6: {
        color: WARSH_COLORS.MADD_6,
        name: 'Madd 6',
        arabic: 'Ù…Ø¯ 6 Ø­Ø±ÙƒØ§Øª',
        counts: 6,
        description: 'Ø§Ù„Ù…Ø¯ Ø§Ù„Ù…ØªØµÙ„ ÙˆØ§Ù„Ù…Ù†ÙØµÙ„ - 6 Ø­Ø±ÙƒØ§Øª Ø¹Ù†Ø¯ ÙˆØ±Ø´',
        howTo: 'ÙŠÙÙ…Ø¯ 6 Ø­Ø±ÙƒØ§Øª ÙˆØ¬ÙˆØ¨Ø§Ù‹ (Ø£ÙƒØ«Ø± Ù…Ù† Ø­ÙØµ)'
      },
      madd_tabii: {
        color: WARSH_COLORS.MADD_TABII,
        name: 'Madd Tabii',
        arabic: 'Ù…Ø¯ Ø·Ø¨ÙŠØ¹ÙŠ',
        counts: 2,
        description: 'Ø§Ù„Ù…Ø¯ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ - Ø­Ø±ÙƒØªØ§Ù†',
        howTo: 'ÙŠÙÙ…Ø¯ Ø­Ø±ÙƒØªÙŠÙ† ÙÙ‚Ø·'
      },
      ghunnah: {
        color: WARSH_COLORS.GHUNNAH,
        name: 'Ghunnah',
        arabic: 'ØºÙ†Ø©',
        counts: 2,
        description: 'Ø§Ù„ØºÙ†Ø© - Ø­Ø±ÙƒØªØ§Ù† Ù…Ù† Ø§Ù„Ø£Ù†Ù',
        howTo: 'ØµÙˆØª ÙŠØ®Ø±Ø¬ Ù…Ù† Ø§Ù„Ø®ÙŠØ´ÙˆÙ… (Ø§Ù„Ø£Ù†Ù) Ù…Ø¯Ø© Ø­Ø±ÙƒØªÙŠÙ†'
      },
      qalqalah: {
        color: WARSH_COLORS.QALQALAH,
        name: 'Qalqalah',
        arabic: 'Ù‚Ù„Ù‚Ù„Ø©',
        description: 'Ù‚Ù„Ù‚Ù„Ø© Ø­Ø±ÙˆÙ Ù‚Ø·Ø¨ Ø¬Ø¯',
        howTo: 'Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„Ø­Ø±Ù Ø¹Ù†Ø¯ Ø³ÙƒÙˆÙ†Ù‡: Ù‚ Ø· Ø¨ Ø¬ Ø¯'
      },
      tafkheem: {
        color: WARSH_COLORS.TAFKHEEM,
        name: 'Tafkheem',
        arabic: 'ØªÙØ®ÙŠÙ…',
        description: 'ØªÙØ®ÙŠÙ… Ø­Ø±ÙˆÙ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ø¡: Ø® Øµ Ø¶ Øº Ø· Ù‚ Ø¸',
        howTo: 'ÙŠÙÙ†Ø·Ù‚ Ø§Ù„Ø­Ø±Ù Ù…ÙØ®Ù…Ø§Ù‹ (Ø«Ù‚ÙŠÙ„Ø§Ù‹) Ø¨Ø±ÙØ¹ Ù…Ø¤Ø®Ø±Ø© Ø§Ù„Ù„Ø³Ø§Ù†'
      },
      silent: {
        color: WARSH_COLORS.SILENT,
        name: 'Silent',
        arabic: 'Ù„Ø§ ÙŠÙÙ„ÙØ¸',
        description: 'Ø­Ø±ÙˆÙ Ù„Ø§ ØªÙÙ†Ø·Ù‚',
        howTo: 'ÙŠÙØªØ¬Ø§ÙˆØ² Ù‡Ø°Ø§ Ø§Ù„Ø­Ø±Ù ÙˆÙ„Ø§ ÙŠÙÙ†Ø·Ù‚'
      }
    };

    // Color legend for display (only rules we actually detect)
    const WARSH_COLOR_LEGEND = [
      { color: WARSH_COLORS.QALQALAH, arabic: 'Ù‚Ù„Ù‚Ù„Ø©', name: 'Qalqalah', desc: 'Ù‚ Ø· Ø¨ Ø¬ Ø¯ + Ø³ÙƒÙˆÙ†' },
      { color: WARSH_COLORS.GHUNNAH, arabic: 'ØºÙ†Ø©', name: 'Ghunnah', desc: 'Ù†Ù‘ Ù…Ù‘' },
      { color: WARSH_COLORS.TAFKHEEM, arabic: 'ØªÙØ®ÙŠÙ…', name: 'Tafkheem', desc: 'Ø® Øµ Ø¶ Øº Ø· Ù‚ Ø¸' },
    ];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // WARSH RECITERS (everyayah.com)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const WARSH_RECITERS = {
      ibrahim_dosary: { 
        name: 'Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ', 
        nameEn: 'Ibrahim Al-Dosary',
        baseUrl: 'https://everyayah.com/data/warsh/warsh_ibrahim_aldosary_128kbps',
        quality: '128kbps',
        complete: true
      },
      yassin_jazaery: { 
        name: 'ÙŠØ§Ø³ÙŠÙ† Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ', 
        nameEn: 'Yassin Al-Jazaery',
        baseUrl: 'https://everyayah.com/data/warsh/warsh_yassin_al_jazaery_64kbps',
        quality: '64kbps',
        complete: true
      },
      abdul_basit: { 
        name: 'Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø· Ø¹Ø¨Ø¯ Ø§Ù„ØµÙ…Ø¯', 
        nameEn: 'Abdul Basit (47 missing)',
        baseUrl: 'https://everyayah.com/data/warsh/warsh_Abdul_Basit_128kbps',
        quality: '128kbps',
        complete: false
      },
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SURAH DATA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const SURAH_DATA = [
      null,
      { name: 'Al-Fatiha', arabic: 'Ø§Ù„ÙØ§ØªØ­Ø©', ayahs: 7 },
      { name: 'Al-Baqarah', arabic: 'Ø§Ù„Ø¨Ù‚Ø±Ø©', ayahs: 286 },
      { name: 'Aal-Imran', arabic: 'Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†', ayahs: 200 },
      { name: 'An-Nisa', arabic: 'Ø§Ù„Ù†Ø³Ø§Ø¡', ayahs: 176 },
      { name: 'Al-Maidah', arabic: 'Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©', ayahs: 120 },
      { name: 'Al-Anam', arabic: 'Ø§Ù„Ø£Ù†Ø¹Ø§Ù…', ayahs: 165 },
      { name: 'Al-Araf', arabic: 'Ø§Ù„Ø£Ø¹Ø±Ø§Ù', ayahs: 206 },
      { name: 'Al-Anfal', arabic: 'Ø§Ù„Ø£Ù†ÙØ§Ù„', ayahs: 75 },
      { name: 'At-Tawbah', arabic: 'Ø§Ù„ØªÙˆØ¨Ø©', ayahs: 129 },
      { name: 'Yunus', arabic: 'ÙŠÙˆÙ†Ø³', ayahs: 109 },
      { name: 'Hud', arabic: 'Ù‡ÙˆØ¯', ayahs: 123 },
      { name: 'Yusuf', arabic: 'ÙŠÙˆØ³Ù', ayahs: 111 },
      { name: 'Ar-Rad', arabic: 'Ø§Ù„Ø±Ø¹Ø¯', ayahs: 43 },
      { name: 'Ibrahim', arabic: 'Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…', ayahs: 52 },
      { name: 'Al-Hijr', arabic: 'Ø§Ù„Ø­Ø¬Ø±', ayahs: 99 },
      { name: 'An-Nahl', arabic: 'Ø§Ù„Ù†Ø­Ù„', ayahs: 128 },
      { name: 'Al-Isra', arabic: 'Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡', ayahs: 111 },
      { name: 'Al-Kahf', arabic: 'Ø§Ù„ÙƒÙ‡Ù', ayahs: 110 },
      { name: 'Maryam', arabic: 'Ù…Ø±ÙŠÙ…', ayahs: 98 },
      { name: 'Ta-Ha', arabic: 'Ø·Ù‡', ayahs: 135 },
      { name: 'Al-Anbiya', arabic: 'Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡', ayahs: 112 },
      { name: 'Al-Hajj', arabic: 'Ø§Ù„Ø­Ø¬', ayahs: 78 },
      { name: 'Al-Muminun', arabic: 'Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†', ayahs: 118 },
      { name: 'An-Nur', arabic: 'Ø§Ù„Ù†ÙˆØ±', ayahs: 64 },
      { name: 'Al-Furqan', arabic: 'Ø§Ù„ÙØ±Ù‚Ø§Ù†', ayahs: 77 },
      { name: 'Ash-Shuara', arabic: 'Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡', ayahs: 227 },
      { name: 'An-Naml', arabic: 'Ø§Ù„Ù†Ù…Ù„', ayahs: 93 },
      { name: 'Al-Qasas', arabic: 'Ø§Ù„Ù‚ØµØµ', ayahs: 88 },
      { name: 'Al-Ankabut', arabic: 'Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª', ayahs: 69 },
      { name: 'Ar-Rum', arabic: 'Ø§Ù„Ø±ÙˆÙ…', ayahs: 60 },
      { name: 'Luqman', arabic: 'Ù„Ù‚Ù…Ø§Ù†', ayahs: 34 },
      { name: 'As-Sajdah', arabic: 'Ø§Ù„Ø³Ø¬Ø¯Ø©', ayahs: 30 },
      { name: 'Al-Ahzab', arabic: 'Ø§Ù„Ø£Ø­Ø²Ø§Ø¨', ayahs: 73 },
      { name: 'Saba', arabic: 'Ø³Ø¨Ø£', ayahs: 54 },
      { name: 'Fatir', arabic: 'ÙØ§Ø·Ø±', ayahs: 45 },
      { name: 'Ya-Sin', arabic: 'ÙŠØ³', ayahs: 83 },
      { name: 'As-Saffat', arabic: 'Ø§Ù„ØµØ§ÙØ§Øª', ayahs: 182 },
      { name: 'Sad', arabic: 'Øµ', ayahs: 88 },
      { name: 'Az-Zumar', arabic: 'Ø§Ù„Ø²Ù…Ø±', ayahs: 75 },
      { name: 'Ghafir', arabic: 'ØºØ§ÙØ±', ayahs: 85 },
      { name: 'Fussilat', arabic: 'ÙØµÙ„Øª', ayahs: 54 },
      { name: 'Ash-Shura', arabic: 'Ø§Ù„Ø´ÙˆØ±Ù‰', ayahs: 53 },
      { name: 'Az-Zukhruf', arabic: 'Ø§Ù„Ø²Ø®Ø±Ù', ayahs: 89 },
      { name: 'Ad-Dukhan', arabic: 'Ø§Ù„Ø¯Ø®Ø§Ù†', ayahs: 59 },
      { name: 'Al-Jathiyah', arabic: 'Ø§Ù„Ø¬Ø§Ø«ÙŠØ©', ayahs: 37 },
      { name: 'Al-Ahqaf', arabic: 'Ø§Ù„Ø£Ø­Ù‚Ø§Ù', ayahs: 35 },
      { name: 'Muhammad', arabic: 'Ù…Ø­Ù…Ø¯', ayahs: 38 },
      { name: 'Al-Fath', arabic: 'Ø§Ù„ÙØªØ­', ayahs: 29 },
      { name: 'Al-Hujurat', arabic: 'Ø§Ù„Ø­Ø¬Ø±Ø§Øª', ayahs: 18 },
      { name: 'Qaf', arabic: 'Ù‚', ayahs: 45 },
      { name: 'Adh-Dhariyat', arabic: 'Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª', ayahs: 60 },
      { name: 'At-Tur', arabic: 'Ø§Ù„Ø·ÙˆØ±', ayahs: 49 },
      { name: 'An-Najm', arabic: 'Ø§Ù„Ù†Ø¬Ù…', ayahs: 62 },
      { name: 'Al-Qamar', arabic: 'Ø§Ù„Ù‚Ù…Ø±', ayahs: 55 },
      { name: 'Ar-Rahman', arabic: 'Ø§Ù„Ø±Ø­Ù…Ù†', ayahs: 78 },
      { name: 'Al-Waqiah', arabic: 'Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©', ayahs: 96 },
      { name: 'Al-Hadid', arabic: 'Ø§Ù„Ø­Ø¯ÙŠØ¯', ayahs: 29 },
      { name: 'Al-Mujadila', arabic: 'Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©', ayahs: 22 },
      { name: 'Al-Hashr', arabic: 'Ø§Ù„Ø­Ø´Ø±', ayahs: 24 },
      { name: 'Al-Mumtahina', arabic: 'Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©', ayahs: 13 },
      { name: 'As-Saf', arabic: 'Ø§Ù„ØµÙ', ayahs: 14 },
      { name: 'Al-Jumuah', arabic: 'Ø§Ù„Ø¬Ù…Ø¹Ø©', ayahs: 11 },
      { name: 'Al-Munafiqun', arabic: 'Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†', ayahs: 11 },
      { name: 'At-Taghabun', arabic: 'Ø§Ù„ØªØºØ§Ø¨Ù†', ayahs: 18 },
      { name: 'At-Talaq', arabic: 'Ø§Ù„Ø·Ù„Ø§Ù‚', ayahs: 12 },
      { name: 'At-Tahrim', arabic: 'Ø§Ù„ØªØ­Ø±ÙŠÙ…', ayahs: 12 },
      { name: 'Al-Mulk', arabic: 'Ø§Ù„Ù…Ù„Ùƒ', ayahs: 30 },
      { name: 'Al-Qalam', arabic: 'Ø§Ù„Ù‚Ù„Ù…', ayahs: 52 },
      { name: 'Al-Haqqah', arabic: 'Ø§Ù„Ø­Ø§Ù‚Ø©', ayahs: 52 },
      { name: 'Al-Maarij', arabic: 'Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬', ayahs: 44 },
      { name: 'Nuh', arabic: 'Ù†ÙˆØ­', ayahs: 28 },
      { name: 'Al-Jinn', arabic: 'Ø§Ù„Ø¬Ù†', ayahs: 28 },
      { name: 'Al-Muzzammil', arabic: 'Ø§Ù„Ù…Ø²Ù…Ù„', ayahs: 20 },
      { name: 'Al-Muddathir', arabic: 'Ø§Ù„Ù…Ø¯Ø«Ø±', ayahs: 56 },
      { name: 'Al-Qiyamah', arabic: 'Ø§Ù„Ù‚ÙŠØ§Ù…Ø©', ayahs: 40 },
      { name: 'Al-Insan', arabic: 'Ø§Ù„Ø¥Ù†Ø³Ø§Ù†', ayahs: 31 },
      { name: 'Al-Mursalat', arabic: 'Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª', ayahs: 50 },
      { name: 'An-Naba', arabic: 'Ø§Ù„Ù†Ø¨Ø£', ayahs: 40 },
      { name: 'An-Naziat', arabic: 'Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª', ayahs: 46 },
      { name: 'Abasa', arabic: 'Ø¹Ø¨Ø³', ayahs: 42 },
      { name: 'At-Takwir', arabic: 'Ø§Ù„ØªÙƒÙˆÙŠØ±', ayahs: 29 },
      { name: 'Al-Infitar', arabic: 'Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±', ayahs: 19 },
      { name: 'Al-Mutaffifin', arabic: 'Ø§Ù„Ù…Ø·ÙÙÙŠÙ†', ayahs: 36 },
      { name: 'Al-Inshiqaq', arabic: 'Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚', ayahs: 25 },
      { name: 'Al-Buruj', arabic: 'Ø§Ù„Ø¨Ø±ÙˆØ¬', ayahs: 22 },
      { name: 'At-Tariq', arabic: 'Ø§Ù„Ø·Ø§Ø±Ù‚', ayahs: 17 },
      { name: 'Al-Ala', arabic: 'Ø§Ù„Ø£Ø¹Ù„Ù‰', ayahs: 19 },
      { name: 'Al-Ghashiyah', arabic: 'Ø§Ù„ØºØ§Ø´ÙŠØ©', ayahs: 26 },
      { name: 'Al-Fajr', arabic: 'Ø§Ù„ÙØ¬Ø±', ayahs: 30 },
      { name: 'Al-Balad', arabic: 'Ø§Ù„Ø¨Ù„Ø¯', ayahs: 20 },
      { name: 'Ash-Shams', arabic: 'Ø§Ù„Ø´Ù…Ø³', ayahs: 15 },
      { name: 'Al-Layl', arabic: 'Ø§Ù„Ù„ÙŠÙ„', ayahs: 21 },
      { name: 'Ad-Duhaa', arabic: 'Ø§Ù„Ø¶Ø­Ù‰', ayahs: 11 },
      { name: 'Ash-Sharh', arabic: 'Ø§Ù„Ø´Ø±Ø­', ayahs: 8 },
      { name: 'At-Tin', arabic: 'Ø§Ù„ØªÙŠÙ†', ayahs: 8 },
      { name: 'Al-Alaq', arabic: 'Ø§Ù„Ø¹Ù„Ù‚', ayahs: 19 },
      { name: 'Al-Qadr', arabic: 'Ø§Ù„Ù‚Ø¯Ø±', ayahs: 5 },
      { name: 'Al-Bayyinah', arabic: 'Ø§Ù„Ø¨ÙŠÙ†Ø©', ayahs: 8 },
      { name: 'Az-Zalzalah', arabic: 'Ø§Ù„Ø²Ù„Ø²Ù„Ø©', ayahs: 8 },
      { name: 'Al-Adiyat', arabic: 'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª', ayahs: 11 },
      { name: 'Al-Qariah', arabic: 'Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©', ayahs: 11 },
      { name: 'At-Takathur', arabic: 'Ø§Ù„ØªÙƒØ§Ø«Ø±', ayahs: 8 },
      { name: 'Al-Asr', arabic: 'Ø§Ù„Ø¹ØµØ±', ayahs: 3 },
      { name: 'Al-Humazah', arabic: 'Ø§Ù„Ù‡Ù…Ø²Ø©', ayahs: 9 },
      { name: 'Al-Fil', arabic: 'Ø§Ù„ÙÙŠÙ„', ayahs: 5 },
      { name: 'Quraysh', arabic: 'Ù‚Ø±ÙŠØ´', ayahs: 4 },
      { name: 'Al-Maun', arabic: 'Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†', ayahs: 7 },
      { name: 'Al-Kawthar', arabic: 'Ø§Ù„ÙƒÙˆØ«Ø±', ayahs: 3 },
      { name: 'Al-Kafirun', arabic: 'Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†', ayahs: 6 },
      { name: 'An-Nasr', arabic: 'Ø§Ù„Ù†ØµØ±', ayahs: 3 },
      { name: 'Al-Masad', arabic: 'Ø§Ù„Ù…Ø³Ø¯', ayahs: 5 },
      { name: 'Al-Ikhlas', arabic: 'Ø§Ù„Ø¥Ø®Ù„Ø§Øµ', ayahs: 4 },
      { name: 'Al-Falaq', arabic: 'Ø§Ù„ÙÙ„Ù‚', ayahs: 5 },
      { name: 'An-Nas', arabic: 'Ø§Ù„Ù†Ø§Ø³', ayahs: 6 },
    ];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // WARSH TAJWEED - SIMPLE COLORING (like Hafs app approach)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Letter groups
    const TAFKHEEM_LETTERS = 'Ø®ØµØ¶ØºØ·Ø¸';
    const QALQALAH_LETTERS = 'Ù‚Ø·Ø¨Ø¬Ø¯';
    const SUKOON = 'Ù’';
    
    // Simple colorize function - regex based like Hafs app
    const colorizeWarshText = (text) => {
      let html = text;
      
      // Step 1: Qalqalah - letters followed by sukoon
      html = html.replace(new RegExp(`([${QALQALAH_LETTERS}])${SUKOON}`, 'g'), 
        `<span style="color: ${WARSH_COLORS.QALQALAH};" title="Ù‚Ù„Ù‚Ù„Ø©">$1${SUKOON}</span>`
      );
      
      // Step 2: Ghunnah - noon/meem with shaddah
      html = html.replace(/([Ù†Ù…])Ù‘/g, 
        `<span style="color: ${WARSH_COLORS.GHUNNAH};" title="ØºÙ†Ø©">$1Ù‘</span>`
      );
      
      // Step 3: Tafkheem - heavy letters NOT already in spans
      const parts = html.split(/(<span[^>]*>.*?<\/span>)/g);
      html = parts.map(part => {
        if (part.startsWith('<span')) return part;
        return part.replace(new RegExp(`([${TAFKHEEM_LETTERS}Ù‚])`, 'g'),
          `<span style="color: ${WARSH_COLORS.TAFKHEEM};" title="ØªÙØ®ÙŠÙ…">$1</span>`
        );
      }).join('');
      
      return html;
    };
    
    // Extract rules for checklist display
    const extractWarshRules = (text, verseKey) => {
      const rules = [];
      let match;
      
      // Qalqalah
      const qalqalahRegex = new RegExp(`[${QALQALAH_LETTERS}]${SUKOON}`, 'g');
      while ((match = qalqalahRegex.exec(text)) !== null) {
        rules.push({ rule: 'qalqalah', text: match[0], verse: verseKey, arabic_rule: 'Ù‚Ù„Ù‚Ù„Ø©' });
      }
      
      // Ghunnah
      const ghunnahRegex = /[Ù†Ù…]Ù‘/g;
      while ((match = ghunnahRegex.exec(text)) !== null) {
        rules.push({ rule: 'ghunnah', text: match[0], verse: verseKey, arabic_rule: 'ØºÙ†Ø©' });
      }
      
      // Tafkheem
      const tafkheemRegex = new RegExp(`[${TAFKHEEM_LETTERS}Ù‚]`, 'g');
      while ((match = tafkheemRegex.exec(text)) !== null) {
        rules.push({ rule: 'tafkheem', text: match[0], verse: verseKey, arabic_rule: 'ØªÙØ®ÙŠÙ…' });
      }
      
      return rules;
    };

    // Wrapper object for compatibility
    const tajweedEngine = {
      colorizeText: colorizeWarshText,
      analyzeVerse: extractWarshRules
    };
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STORAGE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const STORAGE_KEYS = {
      SETTINGS: 'warsh_tajweed_settings',
      HISTORY: 'warsh_tajweed_history',
      RECORDINGS: 'warsh_tajweed_recordings'
    };

    const loadFromStorage = (key, defaultValue) => {
      try {
        const saved = localStorage.getItem(key);
        return saved ? JSON.parse(saved) : defaultValue;
      } catch (e) {
        return defaultValue;
      }
    };

    const saveToStorage = (key, value) => {
      try {
        localStorage.setItem(key, JSON.stringify(value));
      } catch (e) {
        console.log('Storage error:', e);
      }
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAIN COMPONENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function WarshTajweedTrainer() {
      const savedSettings = loadFromStorage(STORAGE_KEYS.SETTINGS, {});
      
      // Selection state
      const [surahNum, setSurahNum] = useState(savedSettings.surahNum || 1);
      const [ayahStart, setAyahStart] = useState(savedSettings.ayahStart || 1);
      const [ayahEnd, setAyahEnd] = useState(savedSettings.ayahEnd || 7);
      const [reciter, setReciter] = useState(savedSettings.reciter || 'ibrahim_dosary');
      
      // Data state
      const [verses, setVerses] = useState([]);
      const [coloredVerses, setColoredVerses] = useState([]);
      const [detectedRules, setDetectedRules] = useState([]);
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState(null);
      
      // Playback state
      const [isPlaying, setIsPlaying] = useState(false);
      const [currentAyah, setCurrentAyah] = useState(null);
      const [playbackSpeed, setPlaybackSpeed] = useState(savedSettings.playbackSpeed || 0.75);
      const [loopMode, setLoopMode] = useState(savedSettings.loopMode || false);
      
      // Recording state
      const [isRecording, setIsRecording] = useState(false);
      const [recordingTime, setRecordingTime] = useState(0);
      const [audioLevel, setAudioLevel] = useState(0);
      const [recordings, setRecordings] = useState(loadFromStorage(STORAGE_KEYS.RECORDINGS, []));
      const [playingRecording, setPlayingRecording] = useState(null);
      
      // UI state
      const [showLegend, setShowLegend] = useState(false);
      const [showChecklist, setShowChecklist] = useState(false);
      const [fontSize, setFontSize] = useState(savedSettings.fontSize || 28);
      const [lineHeight, setLineHeight] = useState(savedSettings.lineHeight || 2.2);
      const [verseStep, setVerseStep] = useState(savedSettings.verseStep || 5);
      const [currentPage, setCurrentPage] = useState(0);
      const [navStep, setNavStep] = useState(savedSettings.navStep || 5);
      const [isFullscreen, setIsFullscreen] = useState(false);
      
      // Refs
      const audioRef = useRef(null);
      const userAudioRef = useRef(null);
      const mediaRecorderRef = useRef(null);
      const audioContextRef = useRef(null);
      const analyserRef = useRef(null);
      const timerRef = useRef(null);
      const chunksRef = useRef([]);
      
      const maxAyahs = SURAH_DATA[surahNum]?.ayahs || 7;

      // Save settings
      useEffect(() => {
        saveToStorage(STORAGE_KEYS.SETTINGS, {
          surahNum, ayahStart, ayahEnd, reciter, playbackSpeed, loopMode, fontSize, lineHeight, verseStep, navStep
        });
      }, [surahNum, ayahStart, ayahEnd, reciter, playbackSpeed, loopMode, fontSize, lineHeight, verseStep, navStep]);

      // Save recordings
      useEffect(() => {
        const persistable = recordings.map(r => ({
          ...r,
          url: r.dataUrl || null
        })).filter(r => r.url).slice(-10);
        saveToStorage(STORAGE_KEYS.RECORDINGS, persistable);
      }, [recordings]);

      // Fetch Warsh text from API
      const fetchWarshText = async () => {
        setIsLoading(true);
        setError(null);
        
        try {
          const response = await fetch(
            'https://cdn.jsdelivr.net/gh/fawazahmed0/quran-api@1/editions/ara-quranwarsh.json'
          );
          
          if (!response.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Øµ');
          
          const data = await response.json();
          const quranData = data.quran || [];
          
          // Filter to selected range
          const selectedVerses = quranData.filter(v => 
            v.chapter === surahNum && 
            v.verse >= ayahStart && 
            v.verse <= ayahEnd
          );
          
          if (selectedVerses.length === 0) {
            throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¢ÙŠØ§Øª');
          }
          
          setVerses(selectedVerses);
          
          // Apply tajweed coloring
          const colored = [];
          const allRules = [];
          
          for (const verse of selectedVerses) {
            const rules = tajweedEngine.analyzeVerse(verse.text, `${verse.chapter}:${verse.verse}`);
            allRules.push(...rules.map(r => ({ ...r, verse: `${verse.chapter}:${verse.verse}` })));
            
            const coloredHtml = tajweedEngine.colorizeText(verse.text);
            colored.push({
              key: `${verse.chapter}:${verse.verse}`,
              html: coloredHtml,
              plain: verse.text
            });
          }
          
          setColoredVerses(colored);
          
          // Reset pagination
          setCurrentPage(0);
          
          // Deduplicate rules
          const uniqueRules = allRules.reduce((acc, curr) => {
            const key = `${curr.text}-${curr.rule}`;
            if (!acc.find(r => `${r.text}-${r.rule}` === key)) {
              acc.push(curr);
            }
            return acc;
          }, []);
          
          setDetectedRules(uniqueRules);
          
        } catch (err) {
          setError(err.message);
          console.error('Fetch error:', err);
        } finally {
          setIsLoading(false);
        }
      };

      // Audio playback
      const getAudioUrl = (surah, ayah) => {
        const r = WARSH_RECITERS[reciter];
        const s = surah.toString().padStart(3, '0');
        const a = ayah.toString().padStart(3, '0');
        return `${r.baseUrl}/${s}${a}.mp3`;
      };

      const playAudio = (startAyah = ayahStart) => {
        if (audioRef.current) audioRef.current.pause();
        
        const audio = new Audio(getAudioUrl(surahNum, startAyah));
        audio.playbackRate = playbackSpeed;
        audioRef.current = audio;
        setCurrentAyah(startAyah);
        
        audio.onplay = () => setIsPlaying(true);
        audio.onended = () => {
          if (startAyah < ayahEnd) {
            setTimeout(() => playAudio(startAyah + 1), 300);
          } else {
            setIsPlaying(false);
            setCurrentAyah(null);
            if (loopMode) setTimeout(() => playAudio(ayahStart), 500);
          }
        };
        audio.onerror = () => {
          setError(`ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª: ${surahNum}:${startAyah}`);
          setIsPlaying(false);
        };
        audio.play().catch(e => setError('ÙØ´Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„'));
      };

      const stopAudio = () => {
        if (audioRef.current) {
          audioRef.current.pause();
          setIsPlaying(false);
          setCurrentAyah(null);
        }
      };

      // Recording
      const startRecording = async () => {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ 
            audio: { echoCancellation: true, noiseSuppression: true }
          });
          
          audioContextRef.current = new AudioContext();
          analyserRef.current = audioContextRef.current.createAnalyser();
          audioContextRef.current.createMediaStreamSource(stream).connect(analyserRef.current);
          analyserRef.current.fftSize = 256;
          
          const updateLevel = () => {
            if (analyserRef.current && mediaRecorderRef.current?.state === 'recording') {
              const data = new Uint8Array(analyserRef.current.frequencyBinCount);
              analyserRef.current.getByteFrequencyData(data);
              setAudioLevel(data.reduce((a, b) => a + b) / data.length / 128);
              requestAnimationFrame(updateLevel);
            }
          };
          
          mediaRecorderRef.current = new MediaRecorder(stream);
          chunksRef.current = [];
          
          mediaRecorderRef.current.ondataavailable = (e) => {
            if (e.data.size > 0) chunksRef.current.push(e.data);
          };
          
          mediaRecorderRef.current.onstop = () => {
            const blob = new Blob(chunksRef.current, { type: 'audio/webm' });
            const url = URL.createObjectURL(blob);
            
            const reader = new FileReader();
            reader.onloadend = () => {
              const newRec = {
                url,
                dataUrl: reader.result,
                surah: surahNum,
                ayahStart,
                ayahEnd,
                time: Date.now()
              };
              setRecordings(prev => [...prev.slice(-9), newRec]);
            };
            reader.readAsDataURL(blob);
          };
          
          mediaRecorderRef.current.start();
          setIsRecording(true);
          setRecordingTime(0);
          timerRef.current = setInterval(() => setRecordingTime(t => t + 1), 1000);
          requestAnimationFrame(updateLevel);
          
        } catch (err) {
          setError('ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†: ' + err.message);
        }
      };

      const stopRecording = () => {
        if (mediaRecorderRef.current && isRecording) {
          mediaRecorderRef.current.stop();
          mediaRecorderRef.current.stream.getTracks().forEach(t => t.stop());
          setIsRecording(false);
          clearInterval(timerRef.current);
          setAudioLevel(0);
        }
      };

      const playRecording = (rec, idx) => {
        if (userAudioRef.current) userAudioRef.current.pause();
        const audio = new Audio(rec.dataUrl || rec.url);
        userAudioRef.current = audio;
        audio.playbackRate = playbackSpeed;
        setPlayingRecording(idx);
        audio.onended = () => setPlayingRecording(null);
        audio.play();
      };

      const stopUserAudio = () => {
        if (userAudioRef.current) {
          userAudioRef.current.pause();
          setPlayingRecording(null);
        }
      };

      const formatTime = (s) => `${Math.floor(s/60)}:${(s%60).toString().padStart(2,'0')}`;

      // Navigate to next/previous verses in the Quran
      const navigateVerses = (direction) => {
        const step = navStep * direction;
        
        let newSurah = surahNum;
        let newAyahStart = ayahStart + step;
        
        // Handle overflow/underflow
        if (newAyahStart > SURAH_DATA[newSurah]?.ayahs) {
          while (newAyahStart > SURAH_DATA[newSurah]?.ayahs && newSurah < 114) {
            newAyahStart -= SURAH_DATA[newSurah]?.ayahs;
            newSurah++;
          }
          if (newSurah > 114) {
            newSurah = 114;
            newAyahStart = SURAH_DATA[114]?.ayahs;
          }
        } else if (newAyahStart < 1) {
          while (newAyahStart < 1 && newSurah > 1) {
            newSurah--;
            newAyahStart += SURAH_DATA[newSurah]?.ayahs;
          }
          if (newSurah < 1) {
            newSurah = 1;
            newAyahStart = 1;
          }
        }
        
        // Calculate end position
        let newAyahEnd = newAyahStart + navStep - 1;
        if (newAyahEnd > SURAH_DATA[newSurah]?.ayahs) {
          newAyahEnd = SURAH_DATA[newSurah]?.ayahs;
        }
        
        // Update state
        setSurahNum(newSurah);
        setAyahStart(newAyahStart);
        setAyahEnd(newAyahEnd);
        
        // Clear previous data
        setVerses([]);
        setColoredVerses([]);
        setDetectedRules([]);
        setCurrentPage(0);
        setShowChecklist(false);
      };

      // Generate checklist from detected rules
      const generateChecklist = () => {
        const byType = {};
        for (const rule of detectedRules) {
          if (!byType[rule.rule]) byType[rule.rule] = [];
          byType[rule.rule].push(rule);
        }
        
        return Object.entries(byType).map(([ruleKey, items]) => {
          const info = WARSH_TAJWEED_RULES[ruleKey];
          if (!info) return null;
          return {
            rule: ruleKey,
            ...info,
            instances: items.map(i => i.text),
            count: items.length
          };
        }).filter(Boolean);
      };

      return (
        <div className="min-h-screen p-2 safe-area-inset">
          <div className="max-w-6xl mx-auto">
            {/* Header */}
            <div className="text-center py-4">
              <h1 className="text-2xl font-bold text-amber-900 font-arabic">
                Ù…Ø¯Ø±Ø¨ Ø§Ù„ØªØ¬ÙˆÙŠØ¯
              </h1>
              <p className="text-amber-700 text-lg font-arabic">Ø±ÙˆØ§ÙŠØ© ÙˆØ±Ø´ Ø¹Ù† Ù†Ø§ÙØ¹</p>
              <p className="text-amber-600/70 text-xs mt-1">Ù„Ù„Ù‚Ø±Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØºØ±Ø¨ Ø£ÙØ±ÙŠÙ‚ÙŠØ§</p>
            </div>

            <div className="grid lg:grid-cols-12 gap-3">
              {/* Left Column - Legend */}
              <div className="lg:col-span-3 space-y-2">
                <button 
                  onClick={() => setShowLegend(!showLegend)}
                  className="w-full bg-white/80 backdrop-blur rounded-xl p-3 text-amber-900 font-arabic flex justify-between items-center shadow-sm"
                >
                  <span>ğŸ¨ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† (11 Ù‚Ø§Ø¹Ø¯Ø©)</span>
                  <span>{showLegend ? 'â–¼' : 'â—€'}</span>
                </button>
                
                {showLegend && (
                  <div className="bg-white/80 backdrop-blur rounded-xl p-3 space-y-1 shadow-sm">
                    {WARSH_COLOR_LEGEND.map((item, i) => (
                      <div key={i} className="flex items-center gap-2 p-2 rounded-lg hover:bg-amber-50">
                        <div 
                          className="w-5 h-5 rounded-full flex-shrink-0 border-2 border-amber-200"
                          style={{ backgroundColor: item.color }}
                        />
                        <div className="flex-1 min-w-0">
                          <div className="text-amber-900 font-arabic text-sm">{item.arabic}</div>
                          <div className="text-amber-600/60 text-xs font-arabic">{item.desc}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}

                {/* Detected Rules Summary */}
                {detectedRules.length > 0 && (
                  <div className="bg-white/80 backdrop-blur rounded-xl p-3 shadow-sm">
                    <div className="text-amber-800 font-bold text-sm font-arabic mb-2">
                      Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…ÙƒØªØ´ÙØ©: {detectedRules.length}
                    </div>
                    <div className="space-y-1 max-h-48 overflow-y-auto hide-scrollbar">
                      {detectedRules.slice(0, 20).map((r, i) => (
                        <div key={i} className="flex items-center gap-2 bg-white/50 rounded p-1.5">
                          <div 
                            className="w-3 h-3 rounded-full flex-shrink-0"
                            style={{ backgroundColor: WARSH_TAJWEED_RULES[r.rule]?.color || '#888' }}
                          />
                          <span className="text-amber-900 font-warsh text-sm truncate">{r.text}</span>
                          <span className="text-amber-600/50 text-xs font-arabic mr-auto">{r.arabic_rule}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>

              {/* Center Column - Main Controls */}
              <div className="lg:col-span-5 space-y-3">
                {/* Selection */}
                <div className="bg-white/80 backdrop-blur rounded-xl p-4 shadow-sm">
                  <div className="text-amber-800 font-bold font-arabic mb-3">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø·Ø¹</div>
                  
                  <div className="space-y-3">
                    <select 
                      value={surahNum}
                      onChange={(e) => {
                        const num = +e.target.value;
                        setSurahNum(num);
                        setAyahStart(1);
                        setAyahEnd(Math.min(7, SURAH_DATA[num]?.ayahs || 7));
                        setVerses([]);
                        setColoredVerses([]);
                        setDetectedRules([]);
                        setCurrentPage(0);
                      }}
                      className="w-full bg-amber-50 border border-amber-300 rounded-lg p-3 text-amber-900 font-arabic text-lg"
                      dir="rtl"
                    >
                      {SURAH_DATA.slice(1).map((s, i) => (
                        <option key={i+1} value={i+1}>
                          {i+1}. {s.arabic}
                        </option>
                      ))}
                    </select>
                    
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <label className="text-amber-700 text-xs font-arabic block mb-1">Ù…Ù† Ø§Ù„Ø¢ÙŠØ©</label>
                        <input
                          type="number"
                          value={ayahStart}
                          onChange={(e) => {
                            const val = Math.max(1, Math.min(maxAyahs, +e.target.value));
                            setAyahStart(val);
                            if (val > ayahEnd) setAyahEnd(val);
                          }}
                          min={1}
                          max={maxAyahs}
                          className="w-full bg-amber-50 border border-amber-300 rounded-lg p-3 text-amber-900 text-center text-lg"
                        />
                      </div>
                      <div>
                        <label className="text-amber-700 text-xs font-arabic block mb-1">Ø¥Ù„Ù‰ Ø§Ù„Ø¢ÙŠØ©</label>
                        <input
                          type="number"
                          value={ayahEnd}
                          onChange={(e) => setAyahEnd(Math.max(ayahStart, Math.min(maxAyahs, +e.target.value)))}
                          min={ayahStart}
                          max={maxAyahs}
                          className="w-full bg-amber-50 border border-amber-300 rounded-lg p-3 text-amber-900 text-center text-lg"
                        />
                      </div>
                    </div>
                    
                    {/* Quick selections */}
                    <div className="flex gap-2 flex-wrap">
                      <button 
                        onClick={() => { setAyahEnd(ayahStart); }}
                        className="px-3 py-2 rounded-lg text-sm bg-amber-100 text-amber-800 font-arabic hover:bg-amber-200"
                      >Ø¢ÙŠØ© ÙˆØ§Ø­Ø¯Ø©</button>
                      <button 
                        onClick={() => { setAyahStart(1); setAyahEnd(maxAyahs); }}
                        className="px-3 py-2 rounded-lg text-sm bg-amber-100 text-amber-800 font-arabic hover:bg-amber-200"
                      >Ø§Ù„Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©</button>
                      <button 
                        onClick={() => { setSurahNum(112); setAyahStart(1); setAyahEnd(4); }}
                        className="px-3 py-2 rounded-lg text-sm bg-amber-100 text-amber-800 font-arabic hover:bg-amber-200"
                      >Ø§Ù„Ø¥Ø®Ù„Ø§Øµ</button>
                    </div>
                    
                    {/* Navigation controls */}
                    <div className="mt-3 pt-3 border-t border-amber-200">
                      <div className="text-amber-700 text-xs font-arabic mb-2">Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨Ù€:</div>
                      <div className="flex items-center gap-2 flex-wrap mb-3">
                        {[1, 5, 10, 20].map(n => (
                          <button
                            key={n}
                            onClick={() => setNavStep(n)}
                            className={`px-4 py-2 rounded-lg text-sm font-bold ${
                              navStep === n 
                                ? 'bg-amber-600 text-white' 
                                : 'bg-amber-100 text-amber-800 hover:bg-amber-200'
                            }`}
                          >
                            {n}
                          </button>
                        ))}
                        <input
                          type="number"
                          value={navStep}
                          onChange={(e) => setNavStep(Math.max(1, Math.min(50, +e.target.value)))}
                          min={1}
                          max={50}
                          className="w-16 bg-amber-50 border border-amber-300 rounded-lg px-2 py-2 text-amber-900 text-sm text-center"
                        />
                      </div>
                      
                      {/* Prev/Next navigation buttons */}
                      <div className="flex gap-2">
                        <button
                          onClick={() => navigateVerses(-1)}
                          disabled={surahNum === 1 && ayahStart === 1}
                          className="flex-1 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-gray-300 disabled:text-gray-500 rounded-xl text-white font-bold font-arabic"
                        >
                          â†’ Ø§Ù„Ø³Ø§Ø¨Ù‚ {navStep}
                        </button>
                        <button
                          onClick={() => navigateVerses(1)}
                          disabled={surahNum === 114 && ayahEnd === SURAH_DATA[114]?.ayahs}
                          className="flex-1 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-gray-300 disabled:text-gray-500 rounded-xl text-white font-bold font-arabic"
                        >
                          Ø§Ù„ØªØ§Ù„ÙŠ {navStep} â†
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Load Button */}
                <button 
                  onClick={fetchWarshText}
                  disabled={isLoading}
                  className="w-full py-4 bg-amber-600 hover:bg-amber-500 disabled:bg-gray-400 rounded-xl text-white text-lg font-bold font-arabic shadow-lg"
                >
                  {isLoading ? 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...' : 'ğŸ“– ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Øµ ÙˆØ§Ù„ØªØ¬ÙˆÙŠØ¯'}
                </button>

                {/* Verse Display */}
                {coloredVerses.length > 0 && (
                  <div className={`${isFullscreen ? 'fixed inset-0 z-50 bg-white p-4 overflow-auto safe-area-inset' : 'bg-white rounded-xl p-4 shadow-lg border-2 border-amber-200'}`}>
                    {/* Controls Bar */}
                    <div className="space-y-2 mb-3 pb-3 border-b border-amber-100">
                      {/* Row 1: Fullscreen + Font + Line height */}
                      <div className="flex items-center justify-between gap-2 flex-wrap">
                        <button
                          onClick={() => setIsFullscreen(!isFullscreen)}
                          className="px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded-lg font-arabic"
                        >
                          {isFullscreen ? 'âœ• Ø¥ØºÙ„Ø§Ù‚' : 'â›¶ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©'}
                        </button>
                        
                        {/* Font size */}
                        <div className="flex items-center gap-1 bg-amber-50 rounded-lg p-1">
                          <span className="text-amber-600 text-xs px-1">Ø­Ø¬Ù…</span>
                          <button onClick={() => setFontSize(Math.max(16, fontSize - 2))} className="w-8 h-8 bg-amber-100 hover:bg-amber-200 rounded text-lg font-bold text-amber-800">âˆ’</button>
                          <span className="text-amber-700 text-sm w-8 text-center">{fontSize}</span>
                          <button onClick={() => setFontSize(Math.min(56, fontSize + 2))} className="w-8 h-8 bg-amber-100 hover:bg-amber-200 rounded text-lg font-bold text-amber-800">+</button>
                        </div>
                        
                        {/* Line height */}
                        <div className="flex items-center gap-1 bg-amber-50 rounded-lg p-1">
                          <span className="text-amber-600 text-xs px-1">ØªØ¨Ø§Ø¹Ø¯</span>
                          <button onClick={() => setLineHeight(Math.max(1.2, lineHeight - 0.2))} className="w-8 h-8 bg-amber-100 hover:bg-amber-200 rounded text-lg font-bold text-amber-800">âˆ’</button>
                          <button onClick={() => setLineHeight(Math.min(4, lineHeight + 0.2))} className="w-8 h-8 bg-amber-100 hover:bg-amber-200 rounded text-lg font-bold text-amber-800">+</button>
                        </div>
                      </div>
                      
                      {/* Row 2: Verses per page */}
                      <div className="flex items-center gap-1 overflow-x-auto hide-scrollbar">
                        <span className="text-amber-600 text-xs whitespace-nowrap font-arabic">Ø¹Ø±Ø¶:</span>
                        {[1, 3, 5, 7, 10, 20, 'Ø§Ù„ÙƒÙ„'].map(n => (
                          <button
                            key={n}
                            onClick={() => { setVerseStep(n === 'Ø§Ù„ÙƒÙ„' ? coloredVerses.length : n); setCurrentPage(0); }}
                            className={`px-3 py-2 rounded-lg text-sm font-arabic whitespace-nowrap ${
                              (n === 'Ø§Ù„ÙƒÙ„' && verseStep >= coloredVerses.length) || verseStep === n 
                                ? 'bg-amber-600 text-white' 
                                : 'bg-amber-100 hover:bg-amber-200 text-amber-800'
                            }`}
                          >
                            {n}
                          </button>
                        ))}
                      </div>
                    </div>
                    
                    {/* Pagination */}
                    {coloredVerses.length > verseStep && (
                      <div className="flex items-center justify-between gap-2 mb-3">
                        <button
                          onClick={() => setCurrentPage(Math.max(0, currentPage - 1))}
                          disabled={currentPage === 0}
                          className="px-4 py-2 bg-amber-600 hover:bg-amber-500 disabled:bg-gray-300 disabled:text-gray-500 text-white text-sm rounded-lg font-arabic"
                        >
                          â†’ Ø§Ù„Ø³Ø§Ø¨Ù‚
                        </button>
                        
                        <span className="text-amber-700 text-sm font-arabic">
                          {currentPage * verseStep + 1}-{Math.min((currentPage + 1) * verseStep, coloredVerses.length)} / {coloredVerses.length}
                        </span>
                        
                        <button
                          onClick={() => setCurrentPage(Math.min(Math.ceil(coloredVerses.length / verseStep) - 1, currentPage + 1))}
                          disabled={(currentPage + 1) * verseStep >= coloredVerses.length}
                          className="px-4 py-2 bg-amber-600 hover:bg-amber-500 disabled:bg-gray-300 disabled:text-gray-500 text-white text-sm rounded-lg font-arabic"
                        >
                          Ø§Ù„ØªØ§Ù„ÙŠ â†
                        </button>
                      </div>
                    )}
                    
                    {/* Verses */}
                    <div 
                      className={`font-warsh leading-loose ${isFullscreen ? '' : 'max-h-80 overflow-y-auto'}`}
                      style={{ fontSize: `${fontSize}px`, lineHeight: lineHeight }}
                    >
                      {coloredVerses
                        .slice(currentPage * verseStep, (currentPage + 1) * verseStep)
                        .map((v, i) => {
                          const ayahNum = parseInt(v.key.split(':')[1]);
                          return (
                            <span key={i} className={currentAyah === ayahNum ? 'bg-amber-100 rounded px-1' : ''}>
                              <span dangerouslySetInnerHTML={{ __html: v.html }} />
                              <span className="text-amber-400 text-sm mx-1">ï´¿{v.key.split(':')[1]}ï´¾</span>
                            </span>
                          );
                        })}
                    </div>
                    
                    {/* Quick color key */}
                    <div className="flex flex-wrap gap-3 mt-3 pt-3 border-t border-amber-100">
                      <span className="text-sm font-arabic" style={{color: WARSH_COLORS.QALQALAH}}>â–  Ù‚Ù„Ù‚Ù„Ø©</span>
                      <span className="text-sm font-arabic" style={{color: WARSH_COLORS.GHUNNAH}}>â–  ØºÙ†Ø©</span>
                      <span className="text-sm font-arabic" style={{color: WARSH_COLORS.TAFKHEEM}}>â–  ØªÙØ®ÙŠÙ…</span>
                    </div>
                  </div>
                )}

                {/* Audio Controls */}
                <div className="bg-white/80 backdrop-blur rounded-xl p-4 shadow-sm">
                  <div className="text-amber-800 font-bold font-arabic mb-3">Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ù‚Ø±Ø¦</div>
                  
                  <select 
                    value={reciter}
                    onChange={(e) => setReciter(e.target.value)}
                    className="w-full bg-amber-50 border border-amber-300 rounded-lg p-3 text-amber-900 font-arabic mb-3"
                    dir="rtl"
                  >
                    {Object.entries(WARSH_RECITERS).map(([k, v]) => (
                      <option key={k} value={k}>
                        {v.name} ({v.quality}) {!v.complete && 'âš ï¸'}
                      </option>
                    ))}
                  </select>
                  
                  <div className="flex items-center gap-2 mb-3">
                    <span className="text-amber-700 text-sm font-arabic">Ø§Ù„Ø³Ø±Ø¹Ø©:</span>
                    {[0.5, 0.75, 1].map(s => (
                      <button
                        key={s}
                        onClick={() => setPlaybackSpeed(s)}
                        className={`flex-1 py-2 rounded-lg font-bold ${
                          playbackSpeed === s 
                            ? 'bg-amber-500 text-white' 
                            : 'bg-amber-100 text-amber-800'
                        }`}
                      >{s}x</button>
                    ))}
                    <button
                      onClick={() => setLoopMode(!loopMode)}
                      className={`px-3 py-2 rounded-lg ${
                        loopMode ? 'bg-orange-500 text-white' : 'bg-amber-100 text-amber-800'
                      }`}
                    >ğŸ”</button>
                  </div>
                  
                  <button
                    onClick={isPlaying ? stopAudio : () => playAudio()}
                    className={`w-full py-4 rounded-xl font-bold text-white text-lg font-arabic ${
                      isPlaying ? 'bg-orange-500' : 'bg-amber-600 hover:bg-amber-500'
                    }`}
                  >
                    {isPlaying ? `â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù (${surahNum}:${currentAyah})` : 'â–¶ï¸ Ø§Ø³ØªÙ…Ø¹'}
                  </button>
                </div>

                {/* Recording */}
                <div className="bg-white/80 backdrop-blur rounded-xl p-4 shadow-sm">
                  <div className="text-amber-800 font-bold font-arabic mb-3">Ø³Ø¬Ù„ ØªÙ„Ø§ÙˆØªÙƒ</div>
                  
                  {/* Level meter */}
                  <div className="mb-3">
                    <div className="h-3 bg-amber-100 rounded-full overflow-hidden">
                      <div 
                        className="h-full bg-gradient-to-r from-green-400 via-yellow-400 to-red-500 transition-all"
                        style={{ width: `${Math.min(100, audioLevel * 100)}%` }}
                      />
                    </div>
                  </div>
                  
                  <button
                    onClick={isRecording ? stopRecording : startRecording}
                    className={`w-full py-4 rounded-xl font-bold text-white text-lg font-arabic ${
                      isRecording ? 'bg-red-500 animate-pulse' : 'bg-amber-600 hover:bg-amber-500'
                    }`}
                  >
                    {isRecording ? `â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù (${formatTime(recordingTime)})` : 'ğŸ™ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„'}
                  </button>
                </div>

                {/* Checklist */}
                {detectedRules.length > 0 && (
                  <button 
                    onClick={() => setShowChecklist(!showChecklist)}
                    className="w-full py-3 bg-teal-600 hover:bg-teal-500 rounded-xl text-white font-bold font-arabic"
                  >
                    {showChecklist ? 'âœ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ÙØªÙˆØ­Ø© â†' : 'ğŸ¯ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'}
                  </button>
                )}
              </div>

              {/* Right Column - Checklist & Recordings */}
              <div className="lg:col-span-4 space-y-3">
                {/* Error */}
                {error && (
                  <div className="bg-red-100 border border-red-300 rounded-xl p-3">
                    <p className="text-red-700 text-sm font-arabic">âš ï¸ {error}</p>
                    <button onClick={() => setError(null)} className="text-red-600 text-xs underline mt-1">
                      Ø¥ØºÙ„Ø§Ù‚
                    </button>
                  </div>
                )}

                {/* Checklist */}
                {showChecklist && detectedRules.length > 0 && (
                  <div className="bg-white/90 backdrop-blur rounded-xl p-4 shadow-lg border-2 border-teal-300">
                    <div className="flex justify-between items-center mb-3">
                      <span className="text-teal-700 font-bold font-arabic">ğŸ¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</span>
                      <button onClick={() => setShowChecklist(false)} className="text-gray-500">âœ•</button>
                    </div>
                    
                    <div className="space-y-3 max-h-96 overflow-y-auto hide-scrollbar">
                      {generateChecklist().map((item, i) => (
                        <div 
                          key={i} 
                          className="rounded-lg p-3 bg-white border-r-4"
                          style={{ borderColor: item.color }}
                        >
                          <div className="flex items-center gap-2 mb-2">
                            <div 
                              className="w-4 h-4 rounded-full"
                              style={{ backgroundColor: item.color }}
                            />
                            <span className="text-amber-900 font-bold font-arabic">{item.arabic}</span>
                            <span className="text-amber-600 text-xs">({item.count}x)</span>
                          </div>
                          
                          <div className="flex flex-wrap gap-1 mb-2">
                            {item.instances.slice(0, 3).map((text, j) => (
                              <span key={j} className="bg-amber-50 px-2 py-0.5 rounded font-warsh text-sm">
                                {text}
                              </span>
                            ))}
                            {item.instances.length > 3 && (
                              <span className="text-amber-500 text-xs">+{item.instances.length - 3}</span>
                            )}
                          </div>
                          
                          <p className="text-amber-700 text-xs font-arabic">{item.howTo}</p>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* Recordings */}
                {recordings.length > 0 && (
                  <div className="bg-white/80 backdrop-blur rounded-xl p-4 shadow-sm">
                    <div className="flex justify-between items-center mb-3">
                      <span className="text-amber-800 font-bold font-arabic">ğŸ§ ØªØ³Ø¬ÙŠÙ„Ø§ØªÙƒ ({recordings.length})</span>
                      <button
                        onClick={() => { if (confirm('Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§ØªØŸ')) setRecordings([]); }}
                        className="text-red-500 text-xs font-arabic"
                      >ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
                    </div>
                    
                    <div className="space-y-2 max-h-48 overflow-y-auto hide-scrollbar">
                      {recordings.slice().reverse().map((r, i) => {
                        const actualIdx = recordings.length - 1 - i;
                        const isPlaying = playingRecording === actualIdx;
                        return (
                          <div
                            key={r.time}
                            className={`flex items-center gap-2 rounded-lg p-2 ${isPlaying ? 'bg-amber-200' : 'bg-white/50'}`}
                          >
                            <button
                              onClick={() => isPlaying ? stopUserAudio() : playRecording(r, actualIdx)}
                              className={`w-10 h-10 rounded-full flex items-center justify-center text-lg ${
                                isPlaying ? 'bg-orange-500 text-white' : 'bg-amber-500 text-white'
                              }`}
                            >
                              {isPlaying ? 'â¹ï¸' : 'â–¶ï¸'}
                            </button>
                            <div className="flex-1 min-w-0">
                              <div className="text-amber-900 text-sm font-arabic truncate">
                                {SURAH_DATA[r.surah]?.arabic} {r.surah}:{r.ayahStart}-{r.ayahEnd}
                              </div>
                              <div className="text-amber-600/50 text-xs">
                                {new Date(r.time).toLocaleTimeString('ar-EG')}
                              </div>
                            </div>
                            <button
                              onClick={() => {
                                const link = document.createElement('a');
                                link.href = r.dataUrl || r.url;
                                link.download = `warsh-${r.surah}-${r.ayahStart}.webm`;
                                link.click();
                              }}
                              className="text-green-600 text-sm px-2"
                            >â¬‡ï¸</button>
                            <button
                              onClick={() => setRecordings(prev => prev.filter((_, idx) => idx !== actualIdx))}
                              className="text-red-400 text-sm px-2"
                            >âœ•</button>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                {/* Info */}
                <div className="bg-white/80 backdrop-blur rounded-xl p-4 shadow-sm">
                  <div className="text-amber-800 font-bold font-arabic mb-2">ğŸ“˜ Ø¹Ù† Ø±ÙˆØ§ÙŠØ© ÙˆØ±Ø´</div>
                  <ul className="text-amber-700/80 text-xs space-y-1 font-arabic">
                    <li>â€¢ ÙˆØ±Ø´ Ù‡Ùˆ Ø¹Ø«Ù…Ø§Ù† Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙŠ</li>
                    <li>â€¢ ØªÙ„Ù‚Ù‰ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¹Ù† Ù†Ø§ÙØ¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ</li>
                    <li>â€¢ Ù…Ù†ØªØ´Ø±Ø© ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ ÙˆØ´Ù…Ø§Ù„ ÙˆØºØ±Ø¨ Ø£ÙØ±ÙŠÙ‚ÙŠØ§</li>
                    <li>â€¢ ØªØªÙ…ÙŠØ² Ø¨Ø§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªÙ‚Ù„ÙŠÙ„ ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ù„</li>
                  </ul>
                  
                  <div className="mt-3 pt-3 border-t border-amber-200">
                    <p className="text-amber-600 text-xs font-arabic">
                      ğŸ“š Ø§Ù„Ù…ØµØ¯Ø±: Ù…Ø¬Ù…Ø¹ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø±ÙŠÙ
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<WarshTajweedTrainer />, document.getElementById('root'));
  </script>
</body>
</html>
